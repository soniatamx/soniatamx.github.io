<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <link href="https://fonts.googleapis.com/css?family=Inter" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: 'Inter', Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 16px 24px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 32px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 16px;
            border-radius: 5px;
            background-color: #E7E7E7;
            padding: 8px;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: left;
            padding: 5px;
            font-weight: bold;
            font-size: 0.5em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
